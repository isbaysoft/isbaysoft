<%# Document controller %>
<% roundbox2 do -%>
  <%= render :partial => 'shared/admin/panel_table', :locals => { :per_page => @documents.per_page } %>
  <% form_for 'tasks', :url => document_url('destroy'), :html =>{:method => :delete, :name=>'adminForm' } do -%>
    <%= hidden_field_tag 'task','0' %>
    <table class="grid" cellspacing="0" cellpadding="0" border="0">
    <thead>
    <th>№</th>
    <th><%= check_box_tag("groups", false, false, :onclick=>"setCheckBoxes(this,'ids[]')") %></th>
    <th><%= sortable('Название','name') %></th>
    <th><%= sortable('Файлов','f_file_name') %></th>
    <th><%= sortable('Раздел','section_name') %></th>
    <th><%= sortable('Категория','category_name') %></th>
    <th><%= sortable('rules.name','Доступ') %></th>
    <th><%= sortable('updated_at','Дата') %></th>
    <th><%= sortable('Публикация','published') %></th>
    <th><%= sortable('Проверен','approved') %></th>
    <th><%= sortable('Размер','f_file_size') %></th>
    <th><%= sortable('Хинты','hits') %></th>
    </thead>
    <tbody>
    <% @documents.map do |row| %>
      <tr class="<%= cycle('odd','even') %>"<%= 'id="after_edit"' if flash[:edited].to_s == row.id.to_s %> >
        <td align="center" width="2%"><%= row.id -%></td>
        <td width="2%"><%= check_box_tag('ids[]',row.id) %></td>
        <td><%= link_to(row.name, edit_document_url(row.id)) -%></td>
        <td><%= row.filelists.count -%></td>
        <td><%= row.section_name -%></td>
        <td><%= row.category.try(:name) -%></td>
        <td><%= row.rule.name -%></td>
        <td><%= row.updated_at.to_formatted_s(:short) -%></td>
        <td><%= check_box_tag("published_#{row.id}",row.published,row.published,:disabled => true) -%></td>
        <td><%= check_box_tag("approved_#{row.id}",row.approved,row.approved,:disabled => true) -%></td>
        <td><%= number_to_human_size(row.filelists.sum('f_file_size')) -%></td>
        <td><%= row.hits.to_i -%></td>
      </tr>
    <% end %>
    </tbody>
    </table>
    <% content_for :toolbar_additional do %>
      <%= btn(:icon_class=>'icon_publish_32',
        :caption => t(:button_on),
        :title => t(:button_activate_user),
        :onclick=>"submitaction('#{publicate_document_url(0)}')") -%>
      <%= btn(:icon_class=>'icon_unpublish_32',
        :caption => t(:button_off),
        :title => t(:button_deactivate_user),
        :onclick=>"submitaction('#{unpublicate_document_url(0)}')") -%>
    <% end %>
    <%= render :partial =>'shared/admin/toolbar_controller', :locals => { :paginated_rows => @documents, :icon_class => 'icon_document_48' } %>
  <% end %>
<% end %>
<%= javascript_tag(visual_effect(:highlight,:after_edit, :duration => 1.3)) if flash[:edited] %>
